---
title: "Introduction to Tivy: Fisheries Data Analysis in Peru"
author: "Hans Ttito"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to Tivy: Fisheries Data Analysis in Peru}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5,
  warning = FALSE,
  message = FALSE
)
```

```{r setup}
library(Tivy)
library(dplyr)
library(ggplot2)
```

## Overview

**Tivy** is a comprehensive R package designed for processing, analyzing, and visualizing fisheries data from Peru's Ministry of Production (PRODUCE). This package provides tools for handling fishing logbooks, length frequency data, vessel tracking information, and regulatory announcements.

## Key Features

- **Data Processing**: Automated processing of fishing hauls, trips, and length frequency data
- **Coordinate Conversion**: DMS to decimal degrees conversion with error correction
- **Spatial Analysis**: Distance calculations to coast and fishing zone analysis
- **Juvenile Analysis**: Fish population structure analysis with length-weight relationships
- **Visualization**: Both static (ggplot2) and interactive (leaflet) mapping capabilities
- **Regulatory Integration**: Processing of official fishing closure announcements

## Quick Start

### 1. Processing Fishing Data

The package includes sample datasets to demonstrate functionality:

```{r eval=FALSE}
# Load sample data (replace with your actual data files)
data("sample_hauls_data")
data("sample_trips_data") 
data("sample_length_data")

# Process hauls data
processed_hauls <- process_hauls(
  data_hauls = sample_hauls_data,
  correct_coordinates = TRUE,
  verbose = TRUE
)

# Process fishing trips
processed_trips <- process_fishing_trips(
  data_fishing_trips = sample_trips_data,
  verbose = TRUE
)

# Process length frequency data
processed_lengths <- process_length(
  data_length = sample_length_data,
  verbose = TRUE
)
```

### 2. Coordinate Conversion

Convert coordinates from degrees-minutes-seconds to decimal degrees:

```{r eval=FALSE}
# Convert DMS coordinates
coordinates <- c("15°30'S", "75°45'W", "16°15'S")
decimal_coords <- dms_to_decimal(coordinates, hemisphere = "S")
print(decimal_coords)
```

### 3. Distance to Coast Calculation

Calculate distances from fishing points to the coastline:

```{r eval=FALSE}
# Calculate distance to coast
distances <- coast_distance(
  lon = processed_hauls$lon_initial,
  lat = processed_hauls$lat_initial,
  distance_type = "haversine",
  unit = "nm"
)
```

### 4. Juvenile Analysis

Analyze juvenile fish proportions in catches:

```{r eval=FALSE}
# Add environmental variables including juvenile analysis
enhanced_data <- add_variables(
  data = processed_hauls,
  JuvLim = 12,  # 12 cm length limit for juveniles
  verbose = TRUE
)

# Summarize juveniles by date
juvenile_summary <- summarize_juveniles_by_group(
  data = processed_lengths,
  group_cols = "date",
  length_cols = find_columns_by_pattern(processed_lengths, "length_"),
  juvenile_limit = 12
)
```

## Data Structure

### Expected Input Formats

The package works with data from PRODUCE's SITRAPESCA system. Expected column patterns include:

**Hauls data:**
- `codigo_faena` or `fishing_trip_code`: Trip identifier
- `numero_cala` or `haul_number`: Haul number
- `latitud_inicial`, `longitud_inicial`: Start coordinates
- `especie` or `species`: Species name
- `captura` or `catch`: Catch amount

**Length data:**
- `talla` or `length`: Length class
- `frecuencia` or `frequency`: Frequency count

### Output Structure

All processing functions return standardized data frames with consistent column names and formats, making it easy to integrate different data sources.

## Workflow Example

Here's a typical workflow for analyzing fisheries data:

```{r eval=FALSE}
# 1. Load and process raw data
hauls <- process_hauls(raw_hauls_data)
trips <- process_fishing_trips(raw_trips_data)
lengths <- process_length(raw_length_data)

# 2. Merge datasets
merged_data <- merge_length_fishing_trips_hauls(
  data_hauls = hauls,
  data_length_fishing_trips = merge(lengths, trips, by = "fishing_trip_code")
)

# 3. Add derived variables
final_data <- add_variables(merged_data, JuvLim = 12)

# 4. Create visualizations
dashboard <- create_fishery_dashboard(
  data = final_data,
  date_col = "start_date_haul",
  length_cols = find_columns_by_pattern(final_data, "weighted_")
)

# View results
dashboard$comparison
dashboard$catch_trends
dashboard$spatial_map
```

## Built-in Datasets

The package includes several built-in datasets:

- `peru_coastline`: Peruvian coastline coordinates
- `peru_coast_parallels`: Parallel lines at different nautical mile distances

```{r eval=FALSE}
# Access built-in coastline data
data("peru_coastline")
head(peru_coastline)

# Use in distance calculations
distances <- coast_distance(
  lon = c(-77.0, -76.5, -76.0),
  lat = c(-12.0, -11.5, -11.0),
  coastline = peru_coastline
)
```

## Getting Help

- Use `?function_name` to get help for specific functions
- Check the package documentation for detailed examples
- Report issues at: https://github.com/yourusername/Tivy/issues

## Next Steps

For more detailed examples, see the other vignettes:

- `vignette("data-processing", package = "Tivy")`: Detailed data processing workflows
- `vignette("spatial-analysis", package = "Tivy")`: Spatial analysis and mapping
- `vignette("juvenile-analysis", package = "Tivy")`: Fish population analysis techniques